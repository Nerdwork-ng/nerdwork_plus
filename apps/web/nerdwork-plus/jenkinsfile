pipeline {
  agent any // Use any available agent (any system that runs java)

  stages{
    stage('Test'){
      steps {
        git branch: 'main', url: 'https://github.com/Nerdwork-ng/nerdwork_plus.git'
        bat 'npm install -g pnpm' // Install pnpm globally
        bat 'pnpm install' // Install project dependencies
        bat 'pnpm test' // Run tests
      }
    }

    stage('Build our image'){
      steps {
        bat 'pnpm build' // Build the Next.js project
        script {
          def imageName = "nerdwork-plus" // Define the Docker image name
          def imageTag = "latest" // Define the Docker image tag
          bat "docker build -t ${imageName}:${imageTag} ." // Build the Docker image
          bat "docker images" // List Docker images to verify the build
        }
      }
    }
  }
}