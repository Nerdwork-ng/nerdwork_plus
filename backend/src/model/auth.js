import { boolean, pgTable, text, timestamp, uuid, integer, } from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { userProfiles } from "./profile";
// ================================
// USERS TABLE (AuthUser)
// ================================
export const authUsers = pgTable("auth_users", {
    id: uuid("id").primaryKey().defaultRandom(), // UUID
    email: text("email").notNull().unique(),
    username: text("username").notNull().unique(),
    passwordHash: text("password_hash").notNull(),
    emailVerified: boolean("email_verified").notNull().default(false),
    twoFactorEnabled: boolean("two_factor_enabled").notNull().default(false),
    lastLoginAt: timestamp("last_login_at", { mode: "date" }).default(null),
    lockedUntil: timestamp("locked_until", { mode: "date" }).default(null),
    loginAttempts: integer("login_attempts").notNull().default(0),
    isActive: boolean("is_active").notNull().default(true),
    createdAt: timestamp("created_at", { mode: "date" }).notNull().defaultNow(),
    updatedAt: timestamp("updated_at", { mode: "date" }).notNull().defaultNow(),
});
// ================================
// SESSIONS TABLE (AuthSession)
// ================================
export const authSessions = pgTable("auth_sessions", {
    id: uuid("id").primaryKey().defaultRandom(),
    userId: uuid("user_id")
        .notNull()
        .references(() => authUsers.id, { onDelete: "cascade" }),
    sessionToken: text("session_token").notNull().unique(),
    refreshToken: text("refresh_token").notNull().unique(),
    ipAddress: text("ip_address").notNull(),
    userAgent: text("user_agent").notNull(),
    expiresAt: timestamp("expires_at", { mode: "date" }).notNull(),
    createdAt: timestamp("created_at", { mode: "date" }).notNull().defaultNow(),
});
// ================================
// PASSWORD RESETS TABLE (PasswordReset)
// ================================
export const passwordResets = pgTable("password_resets", {
    id: uuid("id").primaryKey().defaultRandom(),
    userId: uuid("user_id")
        .notNull()
        .references(() => authUsers.id, { onDelete: "cascade" }),
    token: text("token").notNull().unique(),
    expiresAt: timestamp("expires_at", { mode: "date" }).notNull(),
    used: boolean("used").notNull().default(false),
    createdAt: timestamp("created_at", { mode: "date" }).notNull().defaultNow(),
});
export const authUsersRelations = relations(authUsers, ({ one }) => ({
    profile: one(userProfiles, {
        fields: [authUsers.id],
        references: [userProfiles.authUserId],
    }),
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImF1dGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLE9BQU8sRUFDUCxPQUFPLEVBQ1AsSUFBSSxFQUNKLFNBQVMsRUFDVCxJQUFJLEVBQ0osT0FBTyxHQUNSLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUV4QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRXpDLG1DQUFtQztBQUNuQyx5QkFBeUI7QUFDekIsbUNBQW1DO0FBRW5DLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsWUFBWSxFQUFFO0lBQzdDLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUMsYUFBYSxFQUFFLEVBQUUsT0FBTztJQUNwRCxLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRTtJQUN2QyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRTtJQUM3QyxZQUFZLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLE9BQU8sRUFBRTtJQUM3QyxhQUFhLEVBQUUsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztJQUNqRSxnQkFBZ0IsRUFBRSxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO0lBRXhFLFdBQVcsRUFBRSxTQUFTLENBQUMsZUFBZSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztJQUN2RSxXQUFXLEVBQUUsU0FBUyxDQUFDLGNBQWMsRUFBRSxF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LEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ25FLE9BQU8sRUFBRSxHQUFHLENBQUMsWUFBWSxFQUFFO1FBQ3pCLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7UUFDdEIsVUFBVSxFQUFFLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQztLQUN0QyxDQUFDO0NBQ0gsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIGJvb2xlYW4sXHJcbiAgcGdUYWJsZSxcclxuICB0ZXh0LFxyXG4gIHRpbWVzdGFtcCxcclxuICB1dWlkLFxyXG4gIGludGVnZXIsXHJcbn0gZnJvbSBcImRyaXp6bGUtb3JtL3BnLWNvcmVcIjtcclxuaW1wb3J0IHsgcmVsYXRpb25zIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XHJcblxyXG5pbXBvcnQgeyB1c2VyUHJvZmlsZXMgfSBmcm9tIFwiLi9wcm9maWxlXCI7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBVU0VSUyBUQUJMRSAoQXV0aFVzZXIpXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgY29uc3QgYXV0aFVzZXJzID0gcGdUYWJsZShcImF1dGhfdXNlcnNcIiwge1xyXG4gIGlkOiB1dWlkKFwiaWRcIikucHJpbWFyeUtleSgpLmRlZmF1bHRSYW5kb20oKSwgLy8gVVVJRFxyXG4gIGVtYWlsOiB0ZXh0KFwiZW1haWxcIikubm90TnVsbCgpLnVuaXF1ZSgpLFxyXG4gIHVzZXJuYW1lOiB0ZXh0KFwidXNlcm5hbWVcIikubm90TnVsbCgpLnVuaXF1ZSgpLFxyXG4gIHBhc3N3b3JkSGFzaDogdGV4dChcInBhc3N3b3JkX2hhc2hcIikubm90TnVsbCgpLFxyXG4gIGVtYWlsVmVyaWZpZWQ6IGJvb2xlYW4oXCJlbWFpbF92ZXJpZmllZFwiKS5ub3ROdWxsKCkuZGVmYXVsdChmYWxzZSksXHJcbiAgdHdvRmFjdG9yRW5hYmxlZDogYm9vbGVhbihcInR3b19mYWN0b3JfZW5hYmxlZFwiKS5ub3ROdWxsKCkuZGVmYXVsdChmYWxzZSksXHJcblxyXG4gIGxhc3RMb2dpbkF0OiB0aW1lc3RhbXAoXCJsYXN0X2xvZ2luX2F0XCIsIHsgbW9kZTogXCJkYXRlXCIgfSkuZGVmYXVsdChudWxsKSxcclxuICBsb2NrZWRVbnRpbDogdGltZXN0YW1wKFwibG9ja2VkX3VudGlsXCIsIHsgbW9kZTogXCJkYXRlXCIgfSkuZGVmYXVsdChudWxsKSxcclxuICBsb2dpbkF0dGVtcHRzOiBpbnRlZ2VyKFwibG9naW5fYXR0ZW1wdHNcIikubm90TnVsbCgpLmRlZmF1bHQoMCksXHJcblxyXG4gIGlzQWN0aXZlOiBib29sZWFuKFwiaXNfYWN0aXZlXCIpLm5vdE51bGwoKS5kZWZhdWx0KHRydWUpLFxyXG5cclxuICBjcmVhdGVkQXQ6IHRpbWVzdGFtcChcImNyZWF0ZWRfYXRcIiwgeyBtb2RlOiBcImRhdGVcIiB9KS5ub3ROdWxsKCkuZGVmYXVsdE5vdygpLFxyXG4gIHVwZGF0ZWRBdDogdGltZXN0YW1wKFwidXBkYXRlZF9hdFwiLCB7IG1vZGU6IFwiZGF0ZVwiIH0pLm5vdE51bGwoKS5kZWZhdWx0Tm93KCksXHJcbn0pO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gU0VTU0lPTlMgVEFCTEUgKEF1dGhTZXNzaW9uKVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZXhwb3J0IGNvbnN0IGF1dGhTZXNzaW9ucyA9IHBnVGFibGUoXCJhdXRoX3Nlc3Npb25zXCIsIHtcclxuICBpZDogdXVpZChcImlkXCIpLnByaW1hcnlLZXkoKS5kZWZhdWx0UmFuZG9tKCksXHJcbiAgdXNlcklkOiB1dWlkKFwidXNlcl9pZFwiKVxyXG4gICAgLm5vdE51bGwoKVxyXG4gICAgLnJlZmVyZW5jZXMoKCkgPT4gYXV0aFVzZXJzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcclxuICBzZXNzaW9uVG9rZW46IHRleHQoXCJzZXNzaW9uX3Rva2VuXCIpLm5vdE51bGwoKS51bmlxdWUoKSxcclxuICByZWZyZXNoVG9rZW46IHRleHQoXCJyZWZyZXNoX3Rva2VuXCIpLm5vdE51bGwoKS51bmlxdWUoKSxcclxuICBpcEFkZHJlc3M6IHRleHQoXCJpcF9hZGRyZXNzXCIpLm5vdE51bGwoKSxcclxuICB1c2VyQWdlbnQ6IHRleHQoXCJ1c2VyX2FnZW50XCIpLm5vdE51bGwoKSxcclxuICBleHBpcmVzQXQ6IHRpbWVzdGFtcChcImV4cGlyZXNfYXRcIiwgeyBtb2RlOiBcImRhdGVcIiB9KS5ub3ROdWxsKCksXHJcbiAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoXCJjcmVhdGVkX2F0XCIsIHsgbW9kZTogXCJkYXRlXCIgfSkubm90TnVsbCgpLmRlZmF1bHROb3coKSxcclxufSk7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQQVNTV09SRCBSRVNFVFMgVEFCTEUgKFBhc3N3b3JkUmVzZXQpXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgY29uc3QgcGFzc3dvcmRSZXNldHMgPSBwZ1RhYmxlKFwicGFzc3dvcmRfcmVzZXRzXCIsIHtcclxuICBpZDogdXVpZChcImlkXCIpLnByaW1hcnlLZXkoKS5kZWZhdWx0UmFuZG9tKCksXHJcbiAgdXNlcklkOiB1dWlkKFwidXNlcl9pZFwiKVxyXG4gICAgLm5vdE51bGwoKVxyXG4gICAgLnJlZmVyZW5jZXMoKCkgPT4gYXV0aFVzZXJzLmlkLCB7IG9uRGVsZXRlOiBcImNhc2NhZGVcIiB9KSxcclxuICB0b2tlbjogdGV4dChcInRva2VuXCIpLm5vdE51bGwoKS51bmlxdWUoKSxcclxuICBleHBpcmVzQXQ6IHRpbWVzdGFtcChcImV4cGlyZXNfYXRcIiwgeyBtb2RlOiBcImRhdGVcIiB9KS5ub3ROdWxsKCksXHJcbiAgdXNlZDogYm9vbGVhbihcInVzZWRcIikubm90TnVsbCgpLmRlZmF1bHQoZmFsc2UpLFxyXG4gIGNyZWF0ZWRBdDogdGltZXN0YW1wKFwiY3JlYXRlZF9hdFwiLCB7IG1vZGU6IFwiZGF0ZVwiIH0pLm5vdE51bGwoKS5kZWZhdWx0Tm93KCksXHJcbn0pO1xyXG5cclxuZXhwb3J0IHR5cGUgSW5zZXJ0QXV0aFVzZXIgPSB0eXBlb2YgYXV0aFVzZXJzLiRpbmZlckluc2VydDtcclxuZXhwb3J0IHR5cGUgU2VsZWN0QXV0aFVzZXIgPSB0eXBlb2YgYXV0aFVzZXJzLiRpbmZlclNlbGVjdDtcclxuXHJcbmV4cG9ydCB0eXBlIEluc2VydEF1dGhTZXNzaW9uID0gdHlwZW9mIGF1dGhTZXNzaW9ucy4kaW5mZXJJbnNlcnQ7XHJcbmV4cG9ydCB0eXBlIFNlbGVjdEF1dGhTZXNzaW9uID0gdHlwZW9mIGF1dGhTZXNzaW9ucy4kaW5mZXJTZWxlY3Q7XHJcblxyXG5leHBvcnQgdHlwZSBJbnNlcnRQYXNzd29yZFJlc2V0ID0gdHlwZW9mIHBhc3N3b3JkUmVzZXRzLiRpbmZlckluc2VydDtcclxuZXhwb3J0IHR5cGUgU2VsZWN0UGFzc3dvcmRSZXNldCA9IHR5cGVvZiBwYXNzd29yZFJlc2V0cy4kaW5mZXJTZWxlY3Q7XHJcblxyXG5leHBvcnQgY29uc3QgYXV0aFVzZXJzUmVsYXRpb25zID0gcmVsYXRpb25zKGF1dGhVc2VycywgKHsgb25lIH0pID0+ICh7XHJcbiAgcHJvZmlsZTogb25lKHVzZXJQcm9maWxlcywge1xyXG4gICAgZmllbGRzOiBbYXV0aFVzZXJzLmlkXSxcclxuICAgIHJlZmVyZW5jZXM6IFt1c2VyUHJvZmlsZXMuYXV0aFVzZXJJZF0sXHJcbiAgfSksXHJcbn0pKTtcclxuIl19