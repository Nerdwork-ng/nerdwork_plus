import { issueTicket } from "../services/tickets.service";
import { creditWallet } from "../services/wallet.service";
const verifyHelioSignature = (req) => {
    // For now just simulate verification
    return true;
};
export const helioWebhook = async (req, res) => {
    try {
        if (!verifyHelioSignature(req)) {
            return res.status(400).json({ error: "Invalid signature" });
        }
        const { userId, paymentType, amount, status, eventId, txId } = req.body;
        if (status !== "success") {
            return res.status(400).json({ error: "Payment not successful" });
        }
        if (paymentType === "NWT") {
            // Credit wallet
            await creditWallet(userId, amount);
        }
        // Issue ticket after successful payment
        const ticket = await issueTicket(userId, eventId, paymentType, amount);
        return res.status(200).json({ success: true, ticketId: ticket.id });
    }
    catch (error) {
        console.error("Helio webhook error:", error);
        return res.status(500).json({ error: "Internal server error" });
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVsaW8ud2ViaG9va3MuY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhlbGlvLndlYmhvb2tzLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUUxRCxNQUFNLG9CQUFvQixHQUFHLENBQUMsR0FBWSxFQUFXLEVBQUU7SUFDckQscUNBQXFDO0lBQ3JDLE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7SUFDN0MsSUFBSSxDQUFDO1FBQ0gsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDL0IsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxtQkFBbUIsRUFBRSxDQUFDLENBQUM7UUFDOUQsQ0FBQztRQUVELE1BQU0sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFFeEUsSUFBSSxNQUFNLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDekIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSx3QkFBd0IsRUFBRSxDQUFDLENBQUM7UUFDbkUsQ0FBQztRQUVELElBQUksV0FBVyxLQUFLLEtBQUssRUFBRSxDQUFDO1lBQzFCLGdCQUFnQjtZQUNoQixNQUFNLFlBQVksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDckMsQ0FBQztRQUVELHdDQUF3QztRQUN4QyxNQUFNLE1BQU0sR0FBRyxNQUFNLFdBQVcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUV2RSxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7UUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM3QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLHVCQUF1QixFQUFFLENBQUMsQ0FBQztJQUNsRSxDQUFDO0FBQ0gsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNzdWVUaWNrZXQgfSBmcm9tIFwiLi4vc2VydmljZXMvdGlja2V0cy5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IGNyZWRpdFdhbGxldCB9IGZyb20gXCIuLi9zZXJ2aWNlcy93YWxsZXQuc2VydmljZVwiO1xyXG5cclxuY29uc3QgdmVyaWZ5SGVsaW9TaWduYXR1cmUgPSAocmVxOiBSZXF1ZXN0KTogYm9vbGVhbiA9PiB7XHJcbiAgLy8gRm9yIG5vdyBqdXN0IHNpbXVsYXRlIHZlcmlmaWNhdGlvblxyXG4gIHJldHVybiB0cnVlO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGhlbGlvV2ViaG9vayA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoIXZlcmlmeUhlbGlvU2lnbmF0dXJlKHJlcSkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCBzaWduYXR1cmVcIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IHVzZXJJZCwgcGF5bWVudFR5cGUsIGFtb3VudCwgc3RhdHVzLCBldmVudElkLCB0eElkIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBpZiAoc3RhdHVzICE9PSBcInN1Y2Nlc3NcIikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJQYXltZW50IG5vdCBzdWNjZXNzZnVsXCIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHBheW1lbnRUeXBlID09PSBcIk5XVFwiKSB7XHJcbiAgICAgIC8vIENyZWRpdCB3YWxsZXRcclxuICAgICAgYXdhaXQgY3JlZGl0V2FsbGV0KHVzZXJJZCwgYW1vdW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJc3N1ZSB0aWNrZXQgYWZ0ZXIgc3VjY2Vzc2Z1bCBwYXltZW50XHJcbiAgICBjb25zdCB0aWNrZXQgPSBhd2FpdCBpc3N1ZVRpY2tldCh1c2VySWQsIGV2ZW50SWQsIHBheW1lbnRUeXBlLCBhbW91bnQpO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHN1Y2Nlc3M6IHRydWUsIHRpY2tldElkOiB0aWNrZXQuaWQgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkhlbGlvIHdlYmhvb2sgZXJyb3I6XCIsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBcIkludGVybmFsIHNlcnZlciBlcnJvclwiIH0pO1xyXG4gIH1cclxufTtcclxuIl19